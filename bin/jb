#!/usr/bin/env node
forever = require("forever");
function execute_command(commands){
  var command = process.argv[2];
  if(Object.keys(commands).indexOf(command) !== -1){
    commands[command]();
  } else {
    commands.help();
  }
}

commands = {
  start:function(port){
    var port = process.argv[3] || 80;
    job_board = forever.startDaemon(__dirname + '/../job_board.js',{
      max: 1,
      pidFile: '/var/run/job_board.pid',
      silent: false,
      logFile: '/var/log/job_board.log',
      options: [port]
    });

    /*job_board.on('start', function(process, data){
      console.log('JobBoard Started, listening on port ' + port);
    });*/
    forever.startServer(job_board);
    console.log('JobBoard Started!');
    
  },
  
  stop:function(){
    forever.stop(0);
  },

  restart:function(port){
    stop();
    start(port);
  },
  
  ls:function(){
    console.log('KEY : QUEUE');
    console.log('we-r-1.org 8');
    console.log('events.ran.org 4');
    console.log('app.learn.radicaldesigns.org 0');
  },
  
  add:function(){
    var slug = process.argv[3];
    var endpoint = process.argv[4];
    console.log('added '+slug+' pointed at'+endpoint);
  },
  
  remove:function(){
    var slug = process.argv[3];
  },
  
  rewind:function(){},
  
  help:function(){
  	console.log('LIST OF COMMANDS');
    console.log('start <port>');
    console.log('stop');
    console.log('add <key> <end_point> -c <concurrency> -p');
    console.log('ls');
    console.log('update');
    console.log('remove');
    console.log('rewind');
    console.log('help');
  }
}

execute_command(commands);
